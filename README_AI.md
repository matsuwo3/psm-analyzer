# PSM分析自動レポートツール（AI版）

Claude APIを活用した高度なPSM（Price Sensitivity Meter）分析ツールです。CSVファイルをアップロードするだけで、PSM分析結果とAIによる深いビジネスインサイトを含む包括的なレポートを自動生成します。

## 主な機能

### 📊 自動PSM分析

- **OPP（最適価格点）**: 「高い」と「安い」の交点
- **IDP（妥協価格点）**: 「高すぎる」と「お買い得」の交点
- **PMC（最小抵抗価格点）**: 「高い」と「お買い得」の交点
- **PME（最大ストレス価格点）**: 「高すぎる」と「安い」の交点

### 🤖 AI分析（Claude Sonnet 4.5）

- 分析結果のサマリー
- 具体的な価格設定の推奨事項
- 顧客セグメント分析
- 実装のためのアクションプラン
- 追加調査の提案

### 📈 インタラクティブグラフ

- Plotlyによる美しい可視化
- 4本の累積分布曲線
- 主要指標の交点マーカー
- ズーム、パン、ホバー機能

### 📑 Excelレポート自動生成

- **AIインサイトシート**: Claude分析の全文
- **分析サマリーシート**: PSM主要指標と統計
- **カテゴリ別分析シート**: セグメント別の詳細分析
- **生データシート**: クリーニング済みデータ

### 🎯 カテゴリ別分析

- 性別、年齢、利用頻度などでセグメント分析
- 各セグメントの価格感覚の違いを可視化
- セグメント別の推奨事項を提供

## 必要要件

### システム要件

- Python 3.8以上
- インターネット接続（Claude API利用のため）

### APIキー

- Anthropic Claude APIキー（[こちら](https://console.anthropic.com/)で取得）

## インストール

### 1. リポジトリのクローン

```bash
git clone <repository-url>
cd psm-analyzer
```

### 2. 依存パッケージのインストール

```bash
pip install -r requirements_ai.txt
```

### 3. 環境変数の設定（オプション）

```bash
cp env.template .env
# .env ファイルを編集してAPIキーを設定
nano .env
```

## 使い方

### クイックスタート

```bash
# 起動スクリプトに実行権限を付与
chmod +x run_ai_app.sh

# アプリケーションを起動
./run_ai_app.sh
```

または、直接Streamlitを実行：

```bash
streamlit run psm_analyzer_ai.py --server.port 8501
```

ブラウザで `http://localhost:8501` が自動的に開きます。

### 基本的な使用手順

1. **APIキーを入力**
   - 左サイドバーの「Claude API設定」にAPIキーを入力
   - または、`.env`ファイルに設定して起動時に自動読み込み

2. **CSVファイルをアップロード**
   - 左サイドバーの「データアップロード」からCSVファイルを選択
   - ドラッグ&ドロップにも対応

3. **列を選択**
   - 必須：4つの価格列を選択
     - 「安い」と感じる価格
     - 「お買い得」と感じる価格
     - 「高い」と感じる価格
     - 「高すぎる」と感じる価格
   - オプション：カテゴリ列を選択（性別、年齢など）

4. **分析を実行**
   - 「分析を実行」ボタンをクリック
   - AI分析完了まで30秒程度待機

5. **結果を確認**
   - AIインサイトを確認
   - グラフと統計を確認
   - カテゴリ別分析を確認

6. **レポートをダウンロード**
   - 「Excelレポートをダウンロード」ボタンをクリック
   - すべての分析結果を含むExcelファイルを取得

## データ形式

### 必須列

CSVファイルには以下の4つの価格データ列が必要です：

| 列名（例） | 内容 | データ型 |
|-----------|------|---------|
| 安い価格 | この価格だと「安い」と感じる価格 | 数値 |
| お買い得価格 | この価格だと「お買い得」と感じる価格 | 数値 |
| 高い価格 | この価格だと「高い」と感じる価格 | 数値 |
| 高すぎる価格 | この価格だと「高すぎる」と感じる価格 | 数値 |

### オプション列

以下のようなカテゴリ列を追加すると、セグメント別分析が可能になります：

- 性別（男性/女性）
- 年齢（20代/30代/40代など）
- 利用頻度（週1回/月2-3回など）
- その他の属性データ

### サンプルデータ

```csv
ID,性別,年齢,利用頻度,安い価格,お買い得価格,高い価格,高すぎる価格
1,男性,25,週1回,3000,4000,6000,8000
2,女性,32,月2-3回,3500,4500,7000,9000
...
```

詳細は `sample_data.csv` を参照してください。

## 技術スタック

### フレームワーク

- **Streamlit 1.30.0+**: Webアプリケーションフレームワーク
- **Python 3.8+**: プログラミング言語

### データ処理・分析

- **pandas**: CSVデータの読み込み・前処理
- **numpy**: 数値計算・統計処理
- **plotly**: インタラクティブなグラフ生成

### AI統合

- **anthropic**: Claude API連携
- **Model**: claude-sonnet-4-20250514

### レポート生成

- **openpyxl**: Excelファイル生成

## ファイル構成

```
psm-analyzer/
├── psm_analyzer_ai.py          # メインアプリケーション
├── requirements_ai.txt         # 依存パッケージ
├── run_ai_app.sh              # 起動スクリプト
├── env.template               # 環境変数テンプレート
├── README_AI.md               # このファイル
├── QUICKSTART_AI.md           # クイックスタート
├── sample_data.csv            # サンプルデータ
└── .gitignore                 # Git除外設定
```

## トラブルシューティング

### APIキーエラー

```
❌ APIキーが無効です。正しいAPIキーを入力してください。
```

**解決方法**:
- [Anthropic Console](https://console.anthropic.com/)で正しいAPIキーを取得
- `sk-ant-api03-`で始まるキーであることを確認

### データ不足エラー

```
❌ 分析には最低10件のデータが必要です
```

**解決方法**:
- CSVファイルに最低10行以上のデータがあることを確認
- 欠損データがないことを確認

### インポートエラー

```
ModuleNotFoundError: No module named 'streamlit'
```

**解決方法**:
```bash
pip install -r requirements_ai.txt
```

### ファイル形式エラー

```
❌ CSVファイルをアップロードしてください
```

**解決方法**:
- .csv形式のファイルであることを確認
- UTF-8またはShift-JISエンコーディングを使用

## パフォーマンス

- **ファイルアップロード**: 1秒以内（10MB以下）
- **データプレビュー**: 0.5秒以内
- **PSM分析実行**: 2秒以内（1000行まで）
- **グラフ描画**: 1秒以内
- **AI分析**: 10-30秒
- **Excelレポート生成**: 3秒以内

## セキュリティ

- APIキーはセッション状態でのみ保持（サーバー保存なし）
- アップロードデータはメモリ上のみで処理
- 一時ファイルは作成しない
- セッション終了時に自動破棄

## ライセンス

このプロジェクトは個人利用および商用利用が可能です。

## サポート

質問や問題が発生した場合は、以下を参照してください：

- [クイックスタートガイド](QUICKSTART_AI.md)
- [PSM分析について](https://ja.wikipedia.org/wiki/価格感度分析)
- [Claude API ドキュメント](https://docs.anthropic.com/)
- [Streamlit ドキュメント](https://docs.streamlit.io/)

## 開発者情報

このツールは、Van WestendorpのPrice Sensitivity Meter理論に基づいており、Anthropic Claude APIを活用して深いビジネスインサイトを提供します。

---

**開発日**: 2025年10月
**バージョン**: 1.0.0
**AI Model**: Claude Sonnet 4.5 (claude-sonnet-4-20250514)
